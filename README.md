# API Интеграция с транспортной компанией — Парсер расчётов стоимости доставки

Автоматизированный сбор данных для конкурентного анализа цен на услуги доставки через API.

## Описание

Скрипты для:
- **Выгрузки справочников** (филиалы, терминалы, города)
- **Расчёта стоимости доставки** по различным маршрутам и весовым категориям
- **Мониторинга ценовой политики конкурентов** для оптимизации тарифообразования
- **Автоматической обработки больших объёмов запросов** с контролем ошибок и возобновлением

## Возможности

-  Интеграция с API ПЭК (HTTP Basic Auth)
-  Обработка 20+ весовых и объёмных категорий груза
-  Автоматический расчёт стоимости для всех направлений
-  Система чекпойнтов (восстановление после разрыва соединения)
-  Кэширование промежуточных результатов в Google Drive
-  Экспорт в Excel по форме мониторинга
-  Обработка errors API и retry-логика (exponential backoff)

## Требования

pip install requests pandas openpyxl google-colab


## Использование

### 1. Подготовка данных

Создайте Excel-файлы:
- **cities_from.xlsx**: города отправления (колонки: `senderCity`, `senderWarehouseId`, `pickupAddress`)
- **cities_to.xlsx**: города назначения (колонки: `receiverCity`, `receiverWarehouseId`, `deliveryAddress`)

### 2. Настройка параметров

Откройте скрипт и установите:
USERNAME = "your_pecom_login"
API_KEY = "your_pecom_api_key"


### 3. Запуск

в Google Colab


## Структура данных

### Входные параметры запроса

- **types**: массив ID продуктов ПЭК (1-5)
- **senderWarehouseId / receiverWarehouseId**: ID терминалов
- **plannedDateTime**: дата/время отправки (ближайший понедельник не ранее +6 дней)
- **cargos**: массив грузомест {weight, volume}
- **isPickUp / isDelivery**: услуги доставки
- **isInsurance**: страховка груза

### Выходные данные

Excel-файл в Google Drive:
| Город отправления | Город получателя | до 1 кг | до 5 кг | 100 кг | 0,4м3 | ... |
|---|---|---|---|---|---|---|
| Москва | СПБ | 500 | 450 | 3500 | 7500 | ... |

## Особенности реализации

### Обработка ошибок
- Retry-логика с экспоненциальной задержкой (5s, 10s, 20s...)
- Максимум 5 попыток на запрос
- Кэширование частичных результатов

### Оптимизация производительности
- Rate limiting: 100 запросов/минуту согласно требованиям API документации 
- Минимальный интервал между запросами: 0.6 сек 
- Промежуточное сохранение каждые 1000 запросов

### Восстановление при сбоях
- **progress.json** — номер последней обработанной комбинации
- **results_cache.json** — частичные результаты
- Автоматическое продолжение с места разрыва

## Примеры использования

### Выгрузка справочника терминалов


### Расчёт стоимости


## Результаты и метрики

- Покрытие: все регионы России с сетью транспортной компании
- Типы груза: 26 весовых и объёмных категорий
- Воронки тарификации: автоперевозка, минимальные сборы, услуги
- Формат: стандартная матрица "откуда → куда → цена"

## Источники и лицензии

Основы работы с API взяты из официальной документации ПЭК:  
https://kabinet.pecom.ru/api/v1

Код реализует интеграцию согласно документации и расширяет её автоматизацией и обработкой данных на Python.


## Контакты

- GitHub: github.com/nargizosokina

## Примечания

Требуется учётная запись на https://kabinet.pecom.ru/  
API ключ должен быть скрыт в переменных окружения  
Для использования в production рекомендуется добавить логирование

